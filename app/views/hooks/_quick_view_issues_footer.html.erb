<div id="quick_view_dialogs"></div>
<%= form_tag({:controller=>'quick_view_issues', :action=>:show, :id=>0}, :method=>:get, :id=> 'quick_view_form') do %>
<% end %>
<script>
//<![CDATA[
var quick_view_dialogs = 0;

function quick_view_show_dialog() {
  if (arguments.length == 0) {
     return;
  }

  quick_view_dialogs = 0;
  for (var i = 0; i < arguments.length; ++i) {
     var issue_id = arguments[i];
     var url = '/quick_view_issues/' + issue_id;
     $.ajax( { url: url, dataType: 'html', success: quick_view_dialog_open });
  }
}

function quick_view_dialog_open(dialog_html) {
  $("#quick_view_dialogs").append(dialog_html);

  var m = /id="(quick_view_dialog_[0-9]+)"/.exec(dialog_html);
  if (m == null) return;

  var dialog_id = m[1];

  var last = $(".quick_view_dialog:visible:last");
  var position = null;
  if (last.length == 1 && last.attr("id") != dialog_id) {
     position={ my: "left top", at: "left+10px top+10px", of : last };
  } else {
     if (quick_view_dialogs == 0) {
       position=null;
       position={ my: "center", at: "center" };
     } else {
       adjust = quick_view_dialogs * 10;
       position={ my: "center", at: "left"+adjust+"px top+"+adjust+"px" };
     }
  }
  quick_view_dialogs++;

  $('#'+dialog_id).dialog({
     modal: false,
     closeOnEscape: false,
     width: 800,
     height: 480,
     position: position,
     show: "clip",
     close: "clip",
     buttons: {
        "close" : quick_view_dialog_cancel
     },
     close: quick_view_dialog_close
  });
}


function quick_view_dialog_close(){
  $(this).remove();
}

function quick_view_dialog_cancel(){
  $(this).dialog("close");
}


//]]>
</script>

